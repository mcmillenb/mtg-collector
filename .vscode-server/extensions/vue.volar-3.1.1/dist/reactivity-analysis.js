require(`./path-browserify-RqgFuIaq.js`),require(`./decorateLanguageServiceHost-PG7rPZUH.js`);const e=require(`./typescript-C1DEvdtH.js`);function t(e){return e}function n(e,t,n){let{typescript:r,languageService:i,toSourceRange:a,signals:o,propertyAccesses:s,propertyCalls:c,functionCalls:l}=n,u=_(t)??v(t);if(!u)return;let d=h(u),f=g(u);if(!u.isDependency&&!d.length||!u.isDependent&&!f.length)return;let p=[],m=[];for(let t of d)if(r.isBlock(t.ast)&&t.ast.statements.length){let{statements:n}=t.ast,r=a(n[0].getStart(e),n.at(-1).end);r&&p.push(r)}else p.push({pos:t.pos,end:t.end});for(let{callback:t}of f){if(!t)continue;if(r.isBlock(t.ast)&&t.ast.statements.length){let{statements:n}=t.ast,r=a(n[0].getStart(e),n.at(-1).end);r&&m.push(r)}else m.push({pos:t.pos,end:t.end})}return{dependencyRanges:p,dependentRanges:m};function h(t,n=new Set){if(n.has(t))return[];n.add(t);let a=[],o=t.isDependency;if(t.accessor){let{requireAccess:e}=t.accessor;s(t.accessor,e)}if(!o)return[];return a;function s(t,c,l=!1){if(c){if(r.isPropertyAccessExpression(t.ast)||r.isElementAccessExpression(t.ast)||r.isCallExpression(t.ast)){let s=i.getDefinitionAtPosition(e.fileName,t.pos)??[];for(let i of s){if(i.fileName!==e.fileName)continue;let s=_(i.textSpan.start);if(!s)continue;let c=a.length;for(let e of s.binding?.accessTypes??[])r.isPropertyAccessExpression(t.ast)?(e===`.*`&&t.ast.name.text!==``||e===`.`+t.ast.name.text)&&(a.push(s.binding),o||=s.isDependency):r.isElementAccessExpression(t.ast)?e===`.*`&&(a.push(s.binding),o||=s.isDependency):r.isCallExpression(t.ast)&&e.endsWith(`()`)&&(a.push(s.binding),o||=s.isDependency);if(a.length>c){s.callback&&a.push(s.callback);let e=h(s,n);a.push(...e),o||=e.length>0}}}}else if(!l&&r.isIdentifier(t.ast)){let r=i.getDefinitionAtPosition(e.fileName,t.pos)??[];for(let t of r){if(t.fileName!==e.fileName)continue;let r=_(t.textSpan.start);if(!r)continue;r.binding&&(a.push(r.binding),o||=r.isDependency),r.callback&&a.push(r.callback);let i=h(r,n);a.push(...i),o||=i.length>0}}t.ast.forEachChild(e=>{let n=b(e);n&&s(n,r.isFunctionExpression(t.ast)||r.isArrowFunction(t.ast)||c,r.isPropertyAccessExpression(t.ast)||r.isElementAccessExpression(t.ast))})}}function g(t,n=new Set){if(!t.binding||n.has(t))return[];n.add(t);let r=i.findReferences(e.fileName,t.binding.pos);if(!r)return[];let a=[];for(let i of r.flatMap(e=>e.references)){if(i.fileName!==e.fileName)continue;let r=y(i.textSpan.start);if(r?.accessor){let e=!1;if(r.accessor.requireAccess)for(let n of t.binding.accessTypes)if(n===`.*`)e||=s.has(i.textSpan.start+i.textSpan.length);else if(n===`()`)e||=l.has(i.textSpan.start+i.textSpan.length);else if(n.endsWith(`()`)){let t=c.get(i.textSpan.start+i.textSpan.length);e||=`.`+t+`()`===n}else{let t=s.get(i.textSpan.start+i.textSpan.length);e||=`.`+t===n}else e=!0;if(e){let e=g(r,n);a.push(...e),(r.isDependent||e.length)&&a.push(r)}}}return a}function _(e){return o.find(t=>t.binding&&t.binding.pos<=e&&t.binding.end>=e)}function v(e){return o.filter(t=>t.callback&&t.callback.pos<=e&&t.callback.end>=e).sort((e,t)=>e.callback.end-e.callback.pos-(t.callback.end-t.callback.pos))[0]}function y(e){return o.filter(t=>t.accessor&&t.accessor.pos<=e&&t.accessor.end>=e).sort((e,t)=>e.accessor.end-e.accessor.pos-(t.accessor.end-t.accessor.pos))[0]}function b(t){let n=a(t.getStart(e),t.end);if(n)return{...n,ast:t}}}function r(e,t){return{signals:i(e,t),...a(e,t)}}function i(e,t){let{typescript:n,rules:r,toSourceRange:i}=e,a=[],s=new Set;return c(t),a;function c(e){if(n.isVariableDeclaration(e)){let{name:t,initializer:i}=e;if(i){if(n.isCallExpression(i)&&n.isIdentifier(i.expression)){for(let e of r)if(l(e,i,t)){s.add(i);break}}else if(n.isArrowFunction(i)||n.isFunctionExpression(i)){let e=u(t,i.body);e&&a.push(e)}}}else if(n.isCallExpression(e)&&n.isIdentifier(e.expression)&&!s.has(e)){for(let t of r)if(l(t,e))break}else if(n.isFunctionDeclaration(e)&&e.name&&e.body){let t=u(e.name,e.body);t&&a.push(t)}e.forEachChild(c)}function l(e,t,r){let i=[],s=[],c=t.expression.text;if(!o(e.name,c))return;e.resolve({binding:r,expression:t,typescript:n,match(e,t,n){e===`signal`&&n?i.push([t,n]):s.push([t,e])}});let l={};for(let[e,t]of s){let r=e,i=!1;n.isFunctionLike(e)&&`body`in e&&e.body&&(r=e.body,i=!0);let a=d(r);if(!a)continue;(t===`accessor`||t===`effect`&&i)&&(l.accessor={...a,requireAccess:i}),(t===`callback`||t===`effect`)&&(l.isDependent=!0,l.callback={...a})}if(i.length)for(let[e,t]of i){let n=d(e);if(!n)continue;let r={...l};r.isDependency=!0,r.binding={...n,accessTypes:t},a.push(r)}else a.push(l);return!0}function u(e,t){let n=d(e),r=d(t);if(n&&r)return{binding:{...n,accessTypes:[`()`]},accessor:{...r,requireAccess:!0},callback:r}}function d(e){let n=i(e.getStart(t),e.end);if(n)return{...n,ast:e}}}function a(e,t){let{typescript:n,toSourceRange:r}=e,i=new Map,a=new Map,o=new Set;return s(t),{propertyAccesses:i,propertyCalls:a,functionCalls:o};function s(e){if(n.isPropertyAccessExpression(e)){let n=r(e.expression.getStart(t),e.expression.end);n&&i.set(n.end,e.name.text)}else if(n.isElementAccessExpression(e)){let a=r(e.expression.getStart(t),e.expression.end);if(a){let t=n.isStringLiteralLike(e.argumentExpression)?e.argumentExpression.text:`*`;i.set(a.end,t)}}else if(n.isCallExpression(e)){let{expression:i}=e;if(n.isPropertyAccessExpression(i)){let e=r(i.expression.getStart(t),i.expression.end);e&&a.set(e.end,i.name.text)}else if(n.isIdentifier(i)){let e=r(i.getStart(t),i.end);e&&o.add(e.end)}}e.forEachChild(s)}}function o(e,t){return typeof e==`string`?e===t:e.test(t)}const s=(e,t)=>({pos:e,end:t});function c(e){let{rules:t}=e,i=new WeakMap;return{collect(e,n){if(!i.has(e)){let a={rules:t,toSourceRange:s,...n};i.set(e,r(a,e))}return i.get(e)},analyze(e,t,r){let i={toSourceRange:s,...r,...this.collect(e,r)};return n(e,t,i)}}}var l=t([{name:/^(?:ref(?:[A-Z].*)?|createRef|customRef|extendRef|shallowRef|toRef|useTemplateRef|defineModel)$/,resolve(e){u(e,[`.value`])}},{name:/^(?:reactive(?:[A-Z].*)?|shallowReactive|toReactive|defineProps|withDefaults)$/,resolve(e){u(e,[`.*`])}},{name:/^(?:toRefs|storeToRefs)$/,resolve(e){d(e,[`.value`])}},{name:`computedWithControl`,resolve(e){u(e,[`.value`]);let[t,n]=e.expression.arguments;t&&e.match(`accessor`,t),n&&f(e,n)}},{name:/^computed(?:[A-Z].*)?$/,resolve(e){u(e,[`.value`]);let[t]=e.expression.arguments;t&&f(e,t)}},{name:/^(?:effect|watchEffect)$/,resolve({expression:e,match:t}){let[n]=e.arguments;n&&t(`effect`,n)}},{name:/^(?:watch(?:[A-Z].*)?|whenever)$/,resolve({expression:e,match:t}){let[n,r]=e.arguments;n&&t(`accessor`,n),r&&t(`callback`,r)}},{name:/^use[A-Z].*$/,resolve(e){u(e,[`.*`]),d(e,[`.value`])}}]);function u(e,t){let{binding:n,typescript:r,match:i}=e;n&&r.isIdentifier(n)&&i(`signal`,n,t)}function d(e,t){let{binding:n,typescript:r,match:i}=e;if(n&&r.isObjectBindingPattern(n))for(let e of n.elements)r.isBindingElement(e)&&r.isIdentifier(e.name)&&i(`signal`,e,t)}function f(e,t){let{typescript:n,match:r}=e;if(n.isObjectLiteralExpression(t)){for(let e of t.properties)if(n.isPropertyAssignment(e)){if(n.isIdentifier(e.name)&&e.name.text===`get`){r(`effect`,e.initializer);break}}else if(n.isMethodDeclaration(e)&&n.isIdentifier(e.name)&&e.name.text===`get`){r(`effect`,e);break}}else r(`effect`,t)}let p=-1,m=``,h,g;const _=c({rules:l}),v=({typescript:e})=>({create(t){return t.session&&!t.session.handlers.has(`_vue:getReactivityAnalysis`)&&t.session.addProtocolHandler(`_vue:getReactivityAnalysis`,n=>{let[r,i]=n.arguments;return{response:y(e,t.session,r,i),responseRequired:!0}}),t.languageService}});module.exports=v;function y(t,n,r,i){let{project:a}=n.getFileAndProject({file:r,projectFileName:void 0}),o=a.__vue__?.language;if(!o)return;let s=o.scripts.get(r);if(!s)return;if((h!==s.snapshot||m!==s.id)&&(h=s.snapshot,m=s.id,p++),!g){let n={getProjectVersion:()=>p.toString(),getScriptVersion:()=>p.toString(),getScriptFileNames:()=>[m],getScriptSnapshot:e=>e===m?h:void 0,getCompilationSettings:()=>({allowJs:!0,allowNonTsExtensions:!0}),getCurrentDirectory:()=>``,getDefaultLibFileName:()=>``,readFile:()=>void 0,fileExists:e=>e===m};(0,e.import_typescript.decorateLanguageServiceHost)(t,o,n);let r=(0,e.import_typescript.createProxyLanguageService)(t.createLanguageService(n));r.initialize(o),g=r.proxy}let c=g.getProgram().getSourceFile(s.id),l=s.generated?.languagePlugin.typescript?.getServiceScript(s.generated.root),u=l?o.maps.get(l.code,s):void 0,d=s.generated?s.snapshot.getLength():0,f=u?(e,t)=>{for(let[n,r]of u.toSourceRange(e-d,t-d,!1))return{pos:n,end:r}}:(e,t)=>({pos:e,end:t});return _.analyze(c,i,{typescript:t,languageService:g,toSourceRange:f})}